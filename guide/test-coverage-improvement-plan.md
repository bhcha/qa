# 테스트 커버리지 개선 계획

## 📊 현재 상황 (2025-07-14)
- **전체 커버리지**: 68% (1,604/5,125 명령어)
- **테스트 수**: 871개 (100% 성공)
- **주요 문제**: 일부 패키지의 낮은 커버리지

## 🎯 목표
- **전체 커버리지**: 80% 이상
- **모든 패키지**: 70% 이상
- **핵심 도메인**: 90% 이상

## 📋 우선순위별 개선 계획

### Priority 1: 🔴 Critical (낮은 커버리지)

#### 1. adapter.shared (현재 11%)
**원인**: EventPublisher와 유틸리티 클래스들의 누락된 테스트
**목표**: 70% → **필요한 테스트 추가**:
- [ ] SpringEventPublisher 상세 테스트
- [ ] 공통 유틸리티 클래스들
- [ ] 에러 처리 시나리오

#### 2. adapter.webapi.exception (현재 52%)
**원인**: GlobalExceptionHandler의 미완성 테스트
**목표**: 80% → **필요한 테스트**:
- [ ] 예외 처리 시나리오 보완
- [ ] 메시지 소스 처리
- [ ] 보안 예외 처리

### Priority 2: 🟡 Medium (보통 커버리지 개선)

#### 3. adapter.integration (현재 56%)
**원인**: Keycloak 통합 테스트의 제한적 시나리오
**목표**: 75% → **필요한 테스트**:
- [ ] 연결 실패 시나리오
- [ ] 토큰 갱신 로직
- [ ] 타임아웃 처리

#### 4. domain.authentication (현재 72%)
**원인**: 엣지 케이스 및 실패 시나리오 부족
**목표**: 85% → **필요한 테스트**:
- [ ] 인증 실패 시나리오 추가
- [ ] 토큰 만료 처리
- [ ] 잘못된 자격 증명 처리

### Priority 3: 🟢 Low (높은 커버리지 유지)

#### 5. adapter.security (현재 79%)
**목표**: 85% → **소폭 개선**:
- [ ] JWT 필터 엣지 케이스
- [ ] 보안 헤더 검증
- [ ] IP 제한 시나리오

## 🔄 TDD 보완 계획

### 1. 테스트 품질 개선
- **Missing Tests 우선**: 커버리지가 낮은 클래스부터
- **Red-Green-Refactor**: 각 새 테스트마다 적용
- **Edge Cases**: 경계값, 예외 상황 테스트 강화

### 2. 테스트 구조 개선
- **Given-When-Then**: 모든 테스트의 일관된 구조
- **Mock 최소화**: 실제 로직 검증 우선
- **단위 테스트 순수성**: 외부 의존성 제거

### 3. 커밋 전략
- **구조 변경 먼저**: Tidy First 원칙 적용
- **작은 단위**: 한 번에 하나의 테스트
- **검증 후 커밋**: 모든 테스트 통과 확인

## 📅 실행 계획

### Week 1: adapter.shared 패키지
- [ ] SpringEventPublisher 테스트 완성
- [ ] 유틸리티 클래스 테스트 추가
- [ ] 목표: 11% → 70%

### Week 2: adapter.webapi.exception 패키지  
- [ ] GlobalExceptionHandler 테스트 보완
- [ ] 예외 시나리오 테스트 추가
- [ ] 목표: 52% → 80%

### Week 3: 기타 패키지들
- [ ] adapter.integration 개선 (56% → 75%)
- [ ] domain.authentication 보완 (72% → 85%)
- [ ] adapter.security 마무리 (79% → 85%)

## ⚡ Quick Wins (즉시 개선 가능)

1. **간단한 Getter/Setter 테스트**: DTO 클래스들
2. **Null 체크 테스트**: 생성자, 팩토리 메서드들  
3. **ToString/Equals 테스트**: 도메인 객체들
4. **예외 메시지 테스트**: 검증 로직들

## 📊 측정 지표

### 커버리지 목표
- **명령어 커버리지**: 68% → 80%
- **브랜치 커버리지**: 57% → 75%
- **메서드 커버리지**: 86% → 95%

### 품질 지표  
- **테스트 실행 시간**: 26.5초 유지
- **테스트 안정성**: 100% 성공률 유지
- **코드 복잡도**: 순환 복잡도 감소

## 🚫 금지 사항

1. **통합 테스트 재도입 금지**: Bean 중복 문제 방지
2. **테스트를 위한 테스트 금지**: 의미있는 시나리오만
3. **100% 커버리지 강박 금지**: 품질과 유지보수성 우선
4. **큰 단위 변경 금지**: 작은 단위로 안전하게 진행

## ✅ 완료 기준

- [ ] 전체 커버리지 80% 달성
- [ ] 모든 패키지 70% 이상
- [ ] 100% 테스트 성공률 유지
- [ ] TDD 사이클 문서화 완료